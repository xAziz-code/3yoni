<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3yoni3Leek2</title>
  <style>
    :root{
      --panel: rgba(12,14,18,0.95);
      --panel2: rgba(20,22,28,0.96);
      --text: #eaf0ff;
      --muted:#98a6b7;
      --accent:#2a86ff;
      --row:#1a1f27;
      --rowActive: rgba(42,134,255,0.20);
      --w: 360px;
      --row-h: 36px;
      --r: 10px;
      --shadow: 0 14px 40px rgba(0,0,0,.55);
    }
    *{ box-sizing:border-box; user-select:none; -webkit-user-select:none; font-family: Arial, Helvetica, sans-serif; }
    html,body{ margin:0; background:transparent; color:var(--text); }

    .dock{
      position: fixed; right: 36px; top: 50%; transform: translateY(-50%);
      width: var(--w); max-width: calc(100vw - 40px);
      border-radius: var(--r); background: var(--panel);
      box-shadow: var(--shadow); overflow: hidden;
    }
    .hidden{ display:none !important; }

    .header{
      padding: 12px 14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0)),
        radial-gradient(140px 70px at 85% 0%, rgba(42,134,255,0.35), transparent 70%);
    }
    .banner{
      width: 100%; height: 60px; object-fit: cover;
      border-radius: 8px; margin-bottom: 8px; display:block;
    }
    .brand{ font-size:22px; font-weight:800; letter-spacing:.4px; }
    .list{ background: var(--panel2); padding: 10px; }

    .row{
      height: var(--row-h); line-height: var(--row-h); padding: 0 12px; margin-bottom: 6px;
      border-radius: 6px; background: var(--row); border: 1px solid transparent;
      display:flex; align-items:center; justify-content:space-between; font-size: 14px;
      transition: background .12s, border-color .12s, box-shadow .12s;
    }
    .row:last-child{ margin-bottom:0; }
    .row .label{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .row .hint{ color:var(--muted); font-size:12px; }
    .row.active{ background: var(--rowActive); border-color: var(--accent);
      box-shadow: inset 0 0 0 1px rgba(42,134,255,0.25); }

    .overlay{
      position:absolute; inset:0; background: rgba(12,14,18,0.98);
      transform: translateX(100%); transition: transform .16s ease-out;
      display:flex; flex-direction:column;
    }
    .overlay.open{ transform: translateX(0); }
    .ov-head{ padding:12px 14px; display:flex; justify-content:space-between; align-items:center; }
    .ov-title{ font-weight:700; font-size:15px; }
    .ov-body{ padding:12px; color:var(--muted); }

    .ov-list .row{ margin-bottom:8px; }
    .ov-list .row .state{ color:var(--muted); font-size:12px; margin-left:8px; }
    .ov-list .row.active{ background: var(--rowActive); border-color: var(--accent); }
  </style>
</head>
<body>
  <div id="menu" class="dock hidden" tabindex="-1" aria-hidden="true">
    <div class="header" style="overflow:hidden; border-radius:10px 10px 0 0;">
      <img src="./banner.png?v=2" class="banner" alt="hazetomika" onerror="this.style.display='none'">
      <div class="brand" id="brand">Discord.gg/D99</div>
    </div>

    <div class="list" id="list"></div>

    <div class="overlay" id="overlay">
      <div class="ov-head"><div class="ov-title" id="ovTitle">Submenu</div></div>
      <div class="ov-body">
        <div id="ovList" class="ov-list"></div>
      </div>
    </div>
  </div>

  <script>
    // افتراضي فقط؛ ستأتي العناصر الفعلية من Lua عبر init
    const MODEL = {
      title: 'Discord.gg/D99',
      items: [
        {label:'Menu', hasSub:true, hint:'›'},
        {label:'Sex', hasSub:true, hint:'›'},
        {label:'Menu By 3yonii', hasSub:true, hint:'›'}
      ],
      index: 0,
      submenuOpen: false
    };

    const SUB = { title: '', items: [], index: 0 };

    const menu = document.getElementById('menu');
    const list = document.getElementById('list');
    const brand = document.getElementById('brand');
    const overlay = document.getElementById('overlay');
    const ovTitle = document.getElementById('ovTitle');
    const ovList = document.getElementById('ovList');

    const norm = x => typeof x === 'string' ? {label:x} : x;

    function renderRoot(){
      brand.textContent = MODEL.title;
      list.innerHTML = '';
      MODEL.items.map(norm).forEach((it, i)=>{
        const row = document.createElement('div');
        row.className = 'row' + (i===MODEL.index ? ' active':'' );
        row.innerHTML = '<div class="label">'+it.label+'</div><div class="hint">'+(it.hint||'')+'</div>';
        list.appendChild(row);
      });
    }

    function renderSub(){
      ovTitle.textContent = SUB.title || 'Submenu';
      ovList.innerHTML = '';
      SUB.items.forEach((it, i)=>{
        const row = document.createElement('div');
        row.className = 'row' + (i===SUB.index ? ' active':'' );
        const state = (typeof it.state === 'boolean') ? ('<span class="state">— ' + (it.state ? 'ON' : 'OFF') + '</span>') : '';
        row.innerHTML = '<div class="label">'+it.label+ state +'</div><div class="hint"></div>';
        ovList.appendChild(row);
      });
    }

    function show(){ menu.classList.remove('hidden'); menu.removeAttribute('aria-hidden'); }
    function hide(){ menu.classList.add('hidden'); menu.setAttribute('aria-hidden','true'); }
    function openSub(){ overlay.classList.add('open'); }
    function closeSub(){ overlay.classList.remove('open'); }

    // استقبال أوامر من Lua
    window.addEventListener('message', (event)=>{
      const d = event.data || {};
      if (d.type==='show') { show(); return; }
      if (d.type==='hide') { hide(); return; }

      if (d.type==='init'){
        if (d.title) MODEL.title=d.title;
        if (Array.isArray(d.items)) MODEL.items=d.items;
        MODEL.index = (typeof d.index==='number')? d.index : 0;
        renderRoot(); show(); return;
      }

      if (d.type==='setIndex' && Number.isInteger(d.index)){
        MODEL.index=Math.max(0,Math.min(MODEL.items.length-1,d.index)); renderRoot(); return;
      }

      if (d.type==='setSubmenu' && d.title && Array.isArray(d.items)){
        SUB.title = d.title;
        SUB.items = d.items;
        SUB.index = d.index || 0;
        renderSub(); openSub(); return;
      }

      if (d.type==='setSubIndex' && Number.isInteger(d.index)){
        SUB.index = Math.max(0, Math.min(SUB.items.length-1, d.index)); renderSub(); return;
      }

      if (d.type==='updateSubItems' && Array.isArray(d.items)){
        SUB.items = d.items; renderSub(); return;
      }

      if (d.type==='openSub'){ openSub(); return; }
      if (d.type==='closeSub'){ closeSub(); return; }

      // فتح الروابط الخارجية
      if (d.type === 'openURL' && typeof d.url === 'string'){
        try { window.open(d.url, '_blank'); } catch(e){}
        return;
      }
    });

    renderRoot();
  </script>
</body>
</html>
